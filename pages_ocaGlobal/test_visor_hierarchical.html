<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test del Visor Jer√°rquico de Carpetas y Archivos</title>
    <link href="css/administradorClientes.css" rel="stylesheet">
    <link href="css/visorHistorialArchivos.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
        }
        .test-section h3 {
            color: #00a7b5;
            margin-bottom: 15px;
        }
        .btn-test {
            margin: 5px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1 class="text-center mb-4">
            <i class="fa fa-sitemap"></i> Test del Visor Jer√°rquico
        </h1>

        <!-- Test del Modal Jer√°rquico -->
        <div class="test-section">
            <h3><i class="fa fa-folder-tree"></i> Modal de Navegaci√≥n Jer√°rquica</h3>
            <p>Prueba la funcionalidad completa del modal con navegaci√≥n jer√°rquica de carpetas y archivos.</p>
            
            <div class="text-center mb-3">
                <button type="button" class="btn btn-primary btn-lg btn-test" onclick="testHierarchical.abrirModalCarpetas()">
                    <i class="fa fa-folder-open"></i> Abrir Modal Jer√°rquico
                </button>
                <button type="button" class="btn btn-info btn-lg btn-test" onclick="testHierarchical.simularEstructuraCompleta()">
                    <i class="fa fa-database"></i> Simular Estructura Completa
                </button>
            </div>

            <div class="row">
                <div class="col-md-6">
                    <h5>Funcionalidades a probar:</h5>
                    <ul>
                        <li>‚úÖ Expansi√≥n/contracci√≥n de subcarpetas</li>
                        <li>‚úÖ Visualizaci√≥n de archivos por carpeta</li>
                        <li>‚úÖ Navegaci√≥n jer√°rquica</li>
                        <li>‚úÖ Breadcrumb din√°mico</li>
                        <li>‚úÖ Carga bajo demanda</li>
                        <li>‚úÖ Selecci√≥n de archivos</li>
                    </ul>
                </div>
                <div class="col-md-6">
                    <h5>Estructura de ejemplo:</h5>
                    <ul>
                        <li>üìÅ Plan de Acci√≥n Principal</li>
                        <li>  üìÅ Subcarpeta 1 (expandible)</li>
                        <li>    üìÑ Archivo 1.1</li>
                        <li>    üìÑ Archivo 1.2</li>
                        <li>  üìÅ Subcarpeta 2 (expandible)</li>
                        <li>    üìÑ Archivo 2.1</li>
                        <li>  üìÅ Subcarpeta 3 (expandible)</li>
                        <li>    üìÑ Archivo 3.1</li>
                        <li>  üìÑ Archivo ra√≠z 1</li>
                        <li>  üìÑ Archivo ra√≠z 2</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Test de Responsive -->
        <div class="test-section">
            <h3><i class="fa fa-mobile"></i> Test Responsive</h3>
            <p>Prueba la funcionalidad en diferentes tama√±os de pantalla.</p>
            
            <div class="alert alert-info">
                <i class="fa fa-info-circle"></i>
                <strong>Nota:</strong> Redimensiona la ventana del navegador para probar la responsividad del modal jer√°rquico.
            </div>
        </div>

        <!-- Instrucciones de uso -->
        <div class="test-section">
            <h3><i class="fa fa-question-circle"></i> Instrucciones de Uso</h3>
            <ol>
                <li><strong>Abrir Modal:</strong> Click en "Abrir Modal Jer√°rquico"</li>
                <li><strong>Expandir Carpetas:</strong> Click en las flechas <i class="fa fa-chevron-right"></i> para expandir subcarpetas</li>
                <li><strong>Ver Archivos:</strong> Los archivos aparecen autom√°ticamente al expandir carpetas</li>
                <li><strong>Seleccionar Archivos:</strong> Click en cualquier archivo para ver detalles</li>
                <li><strong>Navegaci√≥n:</strong> Usa el breadcrumb para navegar</li>
                <li><strong>Cerrar:</strong> Click en X, fuera del modal, o presiona Escape</li>
            </ol>
        </div>
    </div>

    <!-- Modal de Carpetas y Archivos -->
    <div id="modal_carpetas" class="modal-carpetas">
        <div class="modal-carpetas-contenido">
            <div class="modal-carpetas-header">
                <h5><i class="fa fa-folder"></i> Estructura de Carpetas y Archivos</h5>
                <span class="modal-carpetas-cerrar" onclick="testHierarchical.cerrarModalCarpetas()">&times;</span>
            </div>
            <div class="modal-carpetas-body">
                <!-- Breadcrumb de navegaci√≥n -->
                <nav aria-label="breadcrumb" class="mb-3">
                    <ol class="breadcrumb" id="breadcrumb_modal">
                        <li class="breadcrumb-item">
                            <a href="#" onclick="testHierarchical.navegarACarpetaModal('root')">
                                <i class="fa fa-home"></i> Inicio
                            </a>
                        </li>
                    </ol>
                </nav>
                
                <!-- Lista de carpetas y archivos -->
                <ul class="lista-carpetas" id="lista_carpetas_modal">
                    <li class="text-center text-muted">
                        <i class="fa fa-folder-open fa-3x mb-3"></i>
                        <p>Cargando estructura de carpetas...</p>
                    </li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        class TestHierarchical {
            constructor() {
                this.estructuraEjemplo = [
                    {
                        id_carpeta_drive: 'carpeta_1',
                        nombre_carpeta: 'Plan de Acci√≥n Principal',
                        tipo_carpeta: 'plan_accion',
                        subcarpetas: [
                            {
                                id_carpeta_drive: 'subcarpeta_1_1',
                                nombre_carpeta: 'Subcarpeta 1',
                                tipo_carpeta: 'subcarpeta',
                                subcarpetas: []
                            },
                            {
                                id_carpeta_drive: 'subcarpeta_1_2',
                                nombre_carpeta: 'Subcarpeta 2',
                                tipo_carpeta: 'subcarpeta',
                                subcarpetas: []
                            },
                            {
                                id_carpeta_drive: 'subcarpeta_1_3',
                                nombre_carpeta: 'Subcarpeta 3',
                                tipo_carpeta: 'subcarpeta',
                                subcarpetas: []
                            }
                        ]
                    }
                ];

                this.archivosEjemplo = [
                    {
                        id_archivo_drive: 'archivo_1',
                        nombre_archivo_original: 'Documento Principal.pdf',
                        tamano_formateado: '2.5 MB',
                        fecha_formateada: '15/01/2025 10:30',
                        icono_tipo: { icono: 'fa-file-pdf', clase: 'pdf' }
                    },
                    {
                        id_archivo_drive: 'archivo_2',
                        nombre_archivo_original: 'Reporte Mensual.xlsx',
                        tamano_formateado: '1.2 MB',
                        fecha_formateada: '14/01/2025 15:45',
                        icono_tipo: { icono: 'fa-file-excel', clase: 'excel' }
                    }
                ];

                this.configurarEventos();
            }

            configurarEventos() {
                // Cerrar modal al hacer click fuera de √©l
                window.onclick = (event) => {
                    const modal = document.getElementById('modal_carpetas');
                    if (event.target === modal) {
                        this.cerrarModalCarpetas();
                    }
                };

                // Cerrar modal con tecla Escape
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'Escape') {
                        this.cerrarModalCarpetas();
                    }
                });
            }

            abrirModalCarpetas() {
                const modal = document.getElementById('modal_carpetas');
                if (modal) {
                    modal.style.display = 'block';
                    this.simularEstructuraCompleta();
                }
            }

            cerrarModalCarpetas() {
                const modal = document.getElementById('modal_carpetas');
                if (modal) {
                    modal.style.display = 'none';
                }
            }

            simularEstructuraCompleta() {
                this.mostrarEstructuraCompleta(this.archivosEjemplo);
            }

            mostrarEstructuraCompleta(archivosRaiz) {
                const contenedor = document.getElementById('lista_carpetas_modal');
                if (!contenedor) return;

                let html = '';

                // Mostrar carpetas principales
                this.estructuraEjemplo.forEach(carpeta => {
                    html += this.generarHTMLCarpetaModalCompleta(carpeta, 0, archivosRaiz);
                });

                // Mostrar archivos de la carpeta ra√≠z
                if (archivosRaiz && archivosRaiz.length > 0) {
                    archivosRaiz.forEach(archivo => {
                        html += this.generarHTMLArchivoModal(archivo, 0);
                    });
                }

                contenedor.innerHTML = html;
            }

            generarHTMLCarpetaModalCompleta(carpeta, nivel, archivosRaiz) {
                const nivelClass = nivel > 0 ? `nivel-${nivel}` : '';
                const icono = carpeta.tipo_carpeta === 'plan_accion' ? 'fa-folder' : 'fa-folder';
                const tieneSubcarpetas = carpeta.subcarpetas && carpeta.subcarpetas.length > 0;
                const expandirId = `expandir-${carpeta.id_carpeta_drive}`;
                const subcarpetasId = `subcarpetas-${carpeta.id_carpeta_drive}`;
                
                let html = `
                    <li class="carpeta-modal-item ${nivelClass}" 
                        data-id-carpeta="${carpeta.id_carpeta_drive}" 
                        data-tipo="${carpeta.tipo_carpeta}">
                        <button class="btn-expandir" id="${expandirId}" 
                                onclick="testHierarchical.toggleSubcarpetas('${carpeta.id_carpeta_drive}')" 
                                style="display: ${tieneSubcarpetas ? 'inline-block' : 'none'}">
                            <i class="fa fa-chevron-right"></i>
                        </button>
                        <i class="fa ${icono} icono-carpeta"></i>
                        <span class="nombre-carpeta" onclick="testHierarchical.seleccionarCarpetaModal('${carpeta.id_carpeta_drive}', '${carpeta.nombre_carpeta}')">${carpeta.nombre_carpeta}</span>
                        <span class="contador-archivos" id="contador-${carpeta.id_carpeta_drive}">0</span>
                    </li>
                `;

                // Contenedor de subcarpetas (inicialmente oculto)
                if (tieneSubcarpetas) {
                    html += `<div class="subcarpetas-contenedor" id="${subcarpetasId}">`;
                    carpeta.subcarpetas.forEach(subcarpeta => {
                        html += this.generarHTMLCarpetaModalCompleta(subcarpeta, nivel + 1, []);
                    });
                    html += `</div>`;
                }

                return html;
            }

            generarHTMLArchivoModal(archivo, nivel) {
                const nivelClass = nivel > 0 ? `nivel-${nivel}` : '';
                
                return `
                    <li class="archivo-modal-item ${nivelClass}" 
                        onclick="testHierarchical.seleccionarArchivoModal('${archivo.id_archivo_drive}', '${archivo.nombre_archivo_original}')">
                        <i class="fa ${archivo.icono_tipo.icono} icono-archivo ${archivo.icono_tipo.clase}"></i>
                        <span class="nombre-archivo">${archivo.nombre_archivo_original}</span>
                        <span class="tamano-archivo">${archivo.tamano_formateado}</span>
                        <span class="fecha-archivo">${archivo.fecha_formateada}</span>
                    </li>
                `;
            }

            toggleSubcarpetas(idCarpetaDrive) {
                const expandirBtn = document.getElementById(`expandir-${idCarpetaDrive}`);
                const subcarpetasContenedor = document.getElementById(`subcarpetas-${idCarpetaDrive}`);
                
                if (expandirBtn && subcarpetasContenedor) {
                    const estaExpandido = subcarpetasContenedor.classList.contains('mostrar');
                    
                    if (estaExpandido) {
                        // Contraer
                        subcarpetasContenedor.classList.remove('mostrar');
                        expandirBtn.classList.remove('expandido');
                        expandirBtn.innerHTML = '<i class="fa fa-chevron-right"></i>';
                    } else {
                        // Expandir
                        subcarpetasContenedor.classList.add('mostrar');
                        expandirBtn.classList.add('expandido');
                        expandirBtn.innerHTML = '<i class="fa fa-chevron-down"></i>';
                        
                        // Cargar archivos de la subcarpeta
                        this.cargarArchivosSubcarpeta(idCarpetaDrive, subcarpetasContenedor);
                    }
                }
            }

            cargarArchivosSubcarpeta(idCarpetaDrive, contenedor) {
                // Simular archivos de subcarpeta
                const archivosSubcarpeta = [
                    {
                        id_archivo_drive: `archivo_${idCarpetaDrive}_1`,
                        nombre_archivo_original: `Archivo de ${idCarpetaDrive}.pdf`,
                        tamano_formateado: '1.5 MB',
                        fecha_formateada: '13/01/2025 09:15',
                        icono_tipo: { icono: 'fa-file-pdf', clase: 'pdf' }
                    },
                    {
                        id_archivo_drive: `archivo_${idCarpetaDrive}_2`,
                        nombre_archivo_original: `Documento de ${idCarpetaDrive}.docx`,
                        tamano_formateado: '800 KB',
                        fecha_formateada: '12/01/2025 14:20',
                        icono_tipo: { icono: 'fa-file-word', clase: 'word' }
                    }
                ];

                // Verificar si ya se cargaron los archivos
                if (contenedor.querySelector('.archivos-cargados')) {
                    return;
                }

                let htmlArchivos = '<div class="archivos-cargados">';
                archivosSubcarpeta.forEach(archivo => {
                    htmlArchivos += this.generarHTMLArchivoModal(archivo, 1);
                });
                htmlArchivos += '</div>';
                
                contenedor.insertAdjacentHTML('beforeend', htmlArchivos);
            }

            seleccionarCarpetaModal(idCarpetaDrive, nombreCarpeta) {
                Swal.fire({
                    icon: 'info',
                    title: 'Carpeta Seleccionada',
                    text: `Has seleccionado: ${nombreCarpeta}`,
                    timer: 2000,
                    showConfirmButton: false
                });
            }

            seleccionarArchivoModal(idArchivoDrive, nombreArchivo) {
                Swal.fire({
                    icon: 'success',
                    title: 'Archivo Seleccionado',
                    text: `Has seleccionado: ${nombreArchivo}`,
                    timer: 2000,
                    showConfirmButton: false
                });
            }

            navegarACarpetaModal(tipo) {
                if (tipo === 'root') {
                    this.mostrarEstructuraCompleta(this.archivosEjemplo);
                    this.actualizarBreadcrumbModal('Inicio');
                }
            }

            actualizarBreadcrumbModal(nombreCarpeta) {
                const breadcrumb = document.getElementById('breadcrumb_modal');
                if (!breadcrumb) return;

                breadcrumb.innerHTML = `
                    <li class="breadcrumb-item">
                        <a href="#" onclick="testHierarchical.navegarACarpetaModal('root')">
                            <i class="fa fa-home"></i> Inicio
                        </a>
                    </li>
                    <li class="breadcrumb-item active">
                        <i class="fa fa-folder"></i> ${nombreCarpeta}
                    </li>
                `;
            }
        }

        // Inicializar cuando el DOM est√© listo
        document.addEventListener('DOMContentLoaded', function() {
            window.testHierarchical = new TestHierarchical();
        });
    </script>
</body>
</html>
